<!DOCTYPE html>
<html lang="ja">

<div class="nav">
  <button onclick="location.href='index.html'">タイムスケジュール</button>
  <button onclick="location.href='シフト表.html'">シフト表</button>
  <button onclick="location.href='予約管理ページ.html'">予約管理</button>
  <button class="active" onclick="location.href='割引設定ページ.html'">割引設定ページ</button>
  <button onclick="location.href='キャストオプションリスト.html'">キャストオプションリスト</button>
</div>

<head>
  <meta charset="UTF-8">
  <title>割引設定ページ</title>
  <style>
    body { font-family: Arial, sans-serif; font-size: 15px; margin: 10px; }
    table { border-collapse: collapse; width: 150%; table-layout: fixed; }
    th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
    th { background: #f0f0f0; position: sticky; top: 0; }
    input { width: 70px; text-align: right; }
    .discount-name { width: 120px; }
    .top-bar { margin-bottom: 10px; }
    #status { margin-left: 10px; color: green; }
  </style>
</head>
<body>
  <h2>割引設定ページ</h2>
  <div class="top-bar">
    <button onclick="addDiscount()">＋割引追加</button>
    <span id="status"></span>
  </div>

  <table id="discountTable">
    <thead>
      <tr>
        <th class="discount-name">割引名</th>
        <th>60</th><th>70</th><th>75</th><th>85</th><th>90</th><th>100</th>
        <th>120</th><th>130</th><th>150</th><th>160</th><th>180</th><th>190</th>
        <th>210</th><th>220</th><th>240</th><th>250</th><th>270</th><th>280</th>
        <th>300</th><th>310</th><th>330</th><th>340</th><th>360</th><th>370</th>
        <th>390</th><th>400</th><th>420</th><th>430</th><th>450</th><th>460</th>
        <th>480</th><th>490</th><th>510</th><th>520</th><th>540</th><th>550</th>
      </tr>
    </thead>
    <tbody id="discountBody"></tbody>
  </table>

  <script>
    const courses = [60,70,75,85,90,100,120,130,150,160,180,190,210,220,240,250,
                     270,280,300,310,330,340,360,370,390,400,420,430,450,460,
                     480,490,510,520,540,550];
    const maxDiscounts = 15;

    // --- 初期プリロードデータ ---
    const preloadedDiscounts = {
      "新規割": {60:-2000,70:-2000,75:-2000,85:-2000,90:-3000,100:-3000},
      "会員限定新人割※アンケート": {60:-2000,70:-2000,75:-2000,85:-2000,90:-3000,100:-3000},
      "新人割": {60:-1000,70:-1000,75:-1000,85:-1000,90:-2000,100:-2000},
      "フーコレ口コミ割": {60:0,70:0,75:0,85:0,90:0,100:0},
      "ヘブン口コミ割": {60:-1000,70:-1000,75:-1000,85:-1000,90:-1000,100:-1000},
      "即姫割": {60:-2000,70:-2000,75:-2000,85:-2000,90:-2000,100:-2000},
      "団体割": {60:-2000,70:-2000,75:-2000,85:-2000,90:-2000,100:-2000},
      "フーコレ口コミ初割": {60:-3000,70:-3000,75:-3000,85:-3000,90:-3000,100:-3000},
      "ヘブン口コミ初割": {60:-3000,70:-3000,75:-3000,85:-3000,90:-3000,100:-3000},
      "フリー割": {60:-3000,70:-3000,75:-3000,85:-3000,90:-5000,100:-5000},
      "フーコレ半額券": {60:-8000,70:-8000,75:-8000,85:-8000,90:-8000,100:-8000},
      "フーコレ無料券": {60:-16000,70:-16000,75:-16000,85:-16000,90:-16000,100:-16000},
      "口コミ当選10000円券": {60:-10000,70:-10000,75:-10000,85:-10000,90:-10000,100:-10000},
      "口コミ当選5000円券": {60:-5000,70:-5000,75:-5000,85:-5000,90:-5000,100:-5000},
      "口コミ当選3000円券": {60:-3000,70:-3000,75:-3000,85:-3000,90:-3000,100:-3000},
      "口コミ当選2000円券": {60:-2000,70:-2000,75:-2000,85:-2000,90:-2000,100:-2000},
      "10回に1回無料": {60:-16000,70:-16000,75:-16000,85:-16000,90:-16000,100:-16000}
    };

    // --- 行生成 ---
    function createRow(name="", data={}) {
      const tr = document.createElement("tr");
      let html = `<td><input type="text" class="discount-name" value="${name}"></td>`;
      courses.forEach(c=>{
        const val = data[c] ?? "";
        html += `<td><input type="number" value="${val}" placeholder="0"></td>`;
      });
      tr.innerHTML = html;

      // 入力時に即保存
      tr.querySelectorAll("input").forEach(inp=>{
        inp.addEventListener("input", saveDiscounts);
      });
      return tr;
    }

    // --- 保存 ---
    function saveDiscounts() {
      const tbody = document.getElementById("discountBody");
      const result = {};
      [...tbody.rows].forEach(row=>{
        const name = row.cells[0].querySelector("input").value.trim();
        if (!name) return;
        const data = {};
        courses.forEach((c,idx)=>{
          const val = row.cells[idx+1].querySelector("input").value;
          if (val) data[c] = parseInt(val);
        });
        result[name] = data;
      });
      localStorage.setItem("discountTable", JSON.stringify(result));
      document.getElementById("status").textContent = "保存しました！";
    }

    // --- 割引追加 ---
    function addDiscount() {
      const tbody = document.getElementById("discountBody");
      if (tbody.rows.length >= maxDiscounts) {
        alert("最大15種類まで登録可能です");
        return;
      }
      tbody.appendChild(createRow());
    }

    // --- 初期ロード ---
    window.addEventListener("load", ()=>{
      const tbody = document.getElementById("discountBody");
      const saved = JSON.parse(localStorage.getItem("discountTable") || "{}");
      const dataToUse = Object.keys(saved).length > 0 ? saved : preloadedDiscounts;
      Object.keys(dataToUse).forEach(n=>{
        tbody.appendChild(createRow(n, dataToUse[n]));
      });
      // 初期ロード時も保存
      localStorage.setItem("discountTable", JSON.stringify(dataToUse));
    });
  </script>
</body>
</html>

